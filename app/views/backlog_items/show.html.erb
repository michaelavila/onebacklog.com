<div class='backlog_items'>
  <div class='row'>
    <div class='span8'>
        <div class='row'>
            <div class='span8'>
                <span id='position' class='<% if @backlog_item.complete %>done<% else %>wip<% end %>'><%= @backlog_item.position %></span>
                <h1><%= best_in_place @backlog_item, :name, :type => :input %></h1>
            </div>
        </div>
        <br>
        <div class='row'>
            <div class='span8 description'>
                <p><%= best_in_place @backlog_item, :description, :type => :textarea %></p>
            </div>
        </div>
    </div>
    <div class='span4'>
      <ul class='nav nav-list well'>
          <li class='nav-header'>Status</li>
          <li id='status' class='<% if @backlog_item.complete %>done<% else %>wip<% end %>'><strong><%= @backlog_item.status.capitalize %>.</strong></li>
          <li class='nav-header'>Current workers</li>
          <% if @backlog_item.assignments.count > 0 %>
            <% @backlog_item.assignments.each do |assignment| %>
                <li><small><%= assignment.user.email %></small></li>
            <% end %>
          <% else %>
            <li><small>No active people</small></li>
          <% end %>
          <li class='nav-header'>Projects</li>
          <li><small><%= @backlog_item.project_list %></small></li>
      </ul>
    </div>
  </div>

  <div class='row'>
      <div class='span5'>
          <h4>Checklist</h4>
          <table class='table table-striped table-noborder'>
              <% @backlog_item.checklist_items.each do |checklist_item| %>
              <tr id='remove_checklist_item_<%= checklist_item.id %>'>
                  <td>
                    <label class='checkbox'>
                      <%= check_box_tag "checklist_item[id='#{checklist_item.id}']", checklist_item.id, checklist_item.completed, :onchange => "$.get('#{toggle_checklist_item_path(checklist_item)}')" %>
                      <%= best_in_place checklist_item, :description, :type => :input, :path => update_checklist_item_path(checklist_item) %> 
                      <span class='pull-right'>
                        <i id='checklist_item_<%= checklist_item.id %>_delete' class='icon-remove' onclick="$.get('/checklist_items/<%= checklist_item.id %>/delete'); $('#remove_checklist_item_<%= checklist_item.id %>').remove();"></i>
                      </span>
                    </label>
                  </td></tr>
              <% end %>
              <tr>
                  <td>
                      <%= form_for @backlog_item.checklist_items.new, :url => create_checklist_item_path(@backlog_item) do |f| %>
                          <%= f.text_field :description, :id => "add_checklist_item_description", :placeholder => "Add checklist item", :class => "input-block-level" %>
                      <% end %>
                  </td>
              </tr>
          </table>
      </div>
      <div class='span7'>
        <div>
          <h4>Discussion</h4>
            <table class='table table-striped table-noborder discussion'>
              <% @backlog_item.comments.each do |comment| %>
              <tr>
                <td>
                  <p><%= comment.comment %></p>
                  <small>
                    <em><%= time_ago_in_words comment.created_at %> ago</em> by <strong><%= comment.user.email || 'Anonymous' %></strong>
                  </small>
                </td>
              </tr>
              <% end %>
              <tr>
                  <td>
                      <%= form_for @backlog_item.comments.new, :url => create_comment_path(@backlog_item) do |f| %>
                          <%= f.text_area :comment, :id => "add_comment_message", :placeholder => "Leave a comment", :class => "input-block-level", :rows => 4 %>
                          <%= f.submit :class => 'btn', :value => 'Leave Comment' %>
                      <% end %>
                  </td>
              </tr>
            </table>
          </div>
      </div>
  </div>

  <div class='row'> <div class='span12'> <hr> </div> </div>

  <div class='row'>
    <div class='span12 dates muted'>
    <small>Created by <strong><%= @backlog_item.creator.email %></strong> <%= time_ago_in_words @backlog_item.created_at %> ago. Last updated by <strong><%= @backlog_item.updater.email %></strong> <%= time_ago_in_words @backlog_item.updated_at %> ago.</small>
    </div>
  </div>
</div>
